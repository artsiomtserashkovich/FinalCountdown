@using System.Threading
@using PrintingMonitor.Printer.Queries;

@implements IDisposable

@inject ICameraCaptureQuery CameraCaptureQuery

<Tile Title="Camera" SizeClasses="col-xl-4 col-md-6 mb-4 h-75">
    <img src="@_imageSource" class="img-fluid rounded mx-auto d-block" alt="Stream" />
</Tile>

@code 
{
    private string _imageSource;
    private Timer timer;

    protected override void OnInitialized()
    {
        timer = new Timer(
            new TimerCallback(async _ =>
            {
                var base64 = CameraCaptureQuery.GetBase64Capture();

                _imageSource = $"data:image/gif;base64,{base64}";

                await InvokeAsync(this.StateHasChanged);
            }),
            null,
            1000,
            5000);

        base.OnInitialized();
    }

    public void Dispose()
    {
        timer?.Dispose();
    }
}